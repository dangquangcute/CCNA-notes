# Phần 4: Phân tích quá trình đóng gói Encapsulation và giải đóng gói Decapsulation  
## 1. Quá trình đóng gói Encapsulationn
-   Trường hợp: Phân tích quá trình chuyển đổi dữ liệu từ pcB sang pcA bằng cách sử dụng mô hình OSI dữ liệu sẽ được phân tích xử lý theo ảnh bên dưới
![Alt text](<Screenshot 2023-08-27 at 20.41.19.png>)
-   Ở lớp physical nó chế biến thành các tín hiệu 0101 rồi truyền lên môi trường chuyền tới thiết bị đầu xa là pcA. Và khi pcA nhận được lưu lượng này thì dữ liệu sẽ được xử lý theo hướng ngược lại gọi là quá trình giải đóng gói. Đầu tiên dữ liệu được xử lý ở lớp physical sau đó tiến dần lên Application hiển thị thông tin cho người dùng 
![Alt text](<Screenshot 2023-08-27 at 20.44.52.png>)
-   Đứng ở góc độ máy gửi là pcB. Khi mà dữ liệu đầu tiên được xử lí bởi lớp Application thì các đơn vị dữ liệu đó được gọi là data, data được xử lí ở lớp 7 (ở đây mình sẽ gọi theo stt cho nhanh ) -> 6. Ở bài trước chúng ta đã phân tích là ở lớp 6 thì chúng ta sẽ được thêm 1 đuôi file vào dữ liệu, để khi mà máy tính nhận được nó sẽ dựa vào đuôi file để nhận biết đây là file hình ảnh hay âm thanh từ đó biết sử dụng phần mềm chính xác nào để mở và đọc file dữ liệu đó. Tiếp tục đẩy xuống lớp 5 để xử lí, lớp session nhận diện đây là dữ liệu thuộc app nào, lớp Session này sẽ phân loại ra, nhận biết đây là dữ liệu thuộc lớp nào. Sau đó chuyển đến lớp 4 để bắt đầu quá trình vận chuyển dữ liệu từ pc B sang pc A thì lúc này lớp transport sẽ quyết định là nên sử dụng giao thức truyền thông tin cậy TCP hay là dịch vụ chuyển phát nhanh UDP, trong trường hợp này là TCP nên nó gắn thêm 1 trường là TCP header. Những thông tin trong trường TCP giúp cho quá trình truyền thông luôn diễn ra một cách tin cậy. Toàn bộ dữ liệu từ lớp transport sẽ được xem là phần data của đơn vị dữ liệu tại lớp Network. Lúc này lớp Network sẽ gắn thêm trường IP header , trong ip header có nhiều thông tin quan trọng đặc biệt là địa chỉ ip nguồn và ip đích. Nhờ địa chỉ được ghi trên ip header thì các Router định tuyến để đến những thiết bị đầu xa. Toàn bộ đơn vị dữ liệu tại lớp Network sẽ được đẩy xuống lớp tiếp theo thấp hơn là Data link, tùy theo môi trường truyền dẫn : Ethernet, pp, HDLC, PPPoE thì trường header sẽ được gắn dữ liệu tương ứng. Lúc này dữ liệu được truyền trên hệ thống mạng Lan nên trường Ethernet header sẽ được gắn vào data. Sau đó lớp Data link này sẽ đẩy dữ liệu xuống lớp cuối cùng là Physical , lớp này chuyển sang định dạng 0101 sau đó truyền đi trên đường chuyền![Alt text](<Screenshot 2023-08-27 at 21.41.29.png>)

## 2. Quá trình giải đóng gói Decapsulation
-   Khi pcA nhận được tín hiệu 0101 từ pcB gửi tới thì nó sẽ làm thao tác lớp physical sẽ nhận và xử lí những bit này sau đó nó sẽ tổng hợp lại và biên dịch thnhà những cấu trúc dữ liệu có thể đọc được 
-    Lúc này lớp Data Link sẽ đọc vào thông tin Ethernet header này xem trong Ethernet header sẽ có những thông tin đặc thù gồm : địa chỉ Mac nguồn và đích. Lớp Data Link sẽ kiểm tra xem Mac đích có phải pcA hay không. Nếu phải thì card mạng sẽ xử lí cấu trúc frame này. Cụ thể nó sẽ gỡ bỏ Ethernet header ra và đẩy dữ liệu lên lớp Network
-   Tại lớp Network đọc vào IP Header xem ip đích có phải của pcA hay không nếu đúng thì nó gỡ bỏ IP Header và toàn bộ phần data chuyển lên  Transport 
-   Tại lớp Transport tùy vào là UDP hay TCP mà nó sẽ sắp xếp lại các segment. Dựa vào stt mà nó nhận được từ TCP header để xếp lại sau đó gỡ bỏ TCP Header và đẩy lên lớp Session 
-    Lớp Session sẽ nhận diện thuộc ứng dụng skype trực tuyến, từ đó mà đẩy cho trình ứng dụng xử lí. Sau đó đẩy thông tin này cho người sử dụng máy tinh
